{% extends "base.html" %}

{% block title %}添加配置 - API配置管理系统{% endblock %}

{% block content %}
<h1>添加新配置</h1>

<form id="configForm">
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label for="name" class="form-label">配置名称 *</label>
                <input type="text" class="form-control" id="name" required>
            </div>
            <div class="mb-3">
                <label for="path" class="form-label">API路径 *</label>
                <input type="text" class="form-control" id="path" placeholder="/api/example" required>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">描述</label>
                <textarea class="form-control" id="description" rows="3"></textarea>
            </div>
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="enabled" checked>
                    <label class="form-check-label" for="enabled">
                        启用此配置
                    </label>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="system_prompt" class="form-label">系统提示词 *</label>
                <textarea class="form-control" id="system_prompt" rows="10" required placeholder="请输入系统提示词，用于指导AI如何处理用户输入..."></textarea>
            </div>
        </div>
    </div>
    
    <div class="mb-3">
        <button type="submit" class="btn btn-primary">保存配置</button>
        <a href="{{ url_for('config_page') }}" class="btn btn-secondary">取消</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('configForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('name').value,
        path: document.getElementById('path').value,
        description: document.getElementById('description').value,
        system_prompt: document.getElementById('system_prompt').value,
        enabled: document.getElementById('enabled').checked
    };
    
    fetch('/config/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('配置添加成功！');
            window.location.href = '/config';
        } else {
            alert('添加失败：' + data.message);
        }
    })
    .catch(error => {
        alert('添加失败：' + error);
    });
});
</script>
{% endblock %}